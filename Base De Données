
# ðŸ—„ï¸ Base de donnÃ©es â€“ Site de vente de parfums (UrbanS)

## ðŸ“Œ Contexte du projet

ðŸ‘‰ **Base de donnÃ©es en place :** **PostgreSQL**, nom de la base **`UrbanS`** (dÃ©jÃ  crÃ©Ã©e).

La documentation ci-dessous dÃ©crit le schÃ©ma cible et les bonnes pratiques Ã  appliquer sur cette base.

---

## ðŸŽ¯ Objectif de la base de donnÃ©es

La base de donnÃ©es doit permettre de :

* GÃ©rer les **parfums et leurs caractÃ©ristiques olfactives**
* Organiser le **catalogue et les filtres** (genre, famille, occasion, intensitÃ©, univers Ã©motionnel)
* GÃ©rer les **commandes avec ou sans compte**
* Assurer le **paiement, la livraison et le suivi**
* Stocker les **avis clients** (comptes et invitÃ©s)
* Garantir la **sÃ©curitÃ© et la conformitÃ© des donnÃ©es** (RGPD)

---

## ðŸ§± Type de base de donnÃ©es

ðŸ‘‰ **PostgreSQL** â€“ Base **`UrbanS`**

* DonnÃ©es structurÃ©es et relations claires
* Transactions fiables pour lâ€™e-commerce
* ConformitÃ© et Ã©volutivitÃ©

---

## ðŸ§© Tables principales (structure logique)

### 1ï¸âƒ£ Table `users` (clients avec compte)

> âš ï¸ Un client peut commander **sans compte** (invitÃ©).

**Champs :**

* `user_id` (PK, SERIAL)
* `nom` (VARCHAR)
* `prenom` (VARCHAR)
* `email` (VARCHAR UNIQUE NOT NULL)
* `mot_de_passe` (VARCHAR, hashÃ© avec bcrypt)
* `telephone` (VARCHAR, nullable)
* `date_creation` (TIMESTAMP DEFAULT NOW())
* `role` (VARCHAR : 'client' | 'admin')
* **RGPD :** `consentement_newsletter` (BOOLEAN DEFAULT false)
* **RGPD :** `consentement_cookies` (BOOLEAN DEFAULT false)
* **RGPD :** `date_consentement` (TIMESTAMP, nullable)

---

### 2ï¸âƒ£ Table `guests` (commandes sans compte)

Pour les commandes invitÃ©es et le suivi sans crÃ©ation de compte.

**Champs :**

* `guest_id` (PK, SERIAL)
* `nom` (VARCHAR)
* `prenom` (VARCHAR)
* `email` (VARCHAR NOT NULL)
* `telephone` (VARCHAR, nullable)
* `date_creation` (TIMESTAMP DEFAULT NOW(), optionnel pour suivi)

---

### 3ï¸âƒ£ Table `products` (parfums)

CÅ“ur du catalogue.

**Champs :**

* `product_id` (PK, SERIAL)
* `nom_parfum` (VARCHAR NOT NULL)
* `description` (TEXT)
* `prix` (DECIMAL(10,2) NOT NULL)
* `stock` (INTEGER DEFAULT 0)
* `intensite` (VARCHAR : LÃ©gÃ¨re | ModÃ©rÃ©e | Intense)
* `type_parfum` (VARCHAR : EDT | EDP | Extrait)
* `volume_ml` (INTEGER, ex. 50, 80, 100)
* `saison` (VARCHAR : Printemps | Ã‰tÃ© | Automne | Hiver | Toutes)
* `genre` (VARCHAR : Homme | Femme | Unisexe)
* `image_principale` (VARCHAR, URL ou chemin)
* `moment_utilisation` (VARCHAR, ex. Quotidien, SoirÃ©e, Ã‰vÃ©nement â€“ ou rÃ©fÃ©rence Ã  une table)
* `date_ajout` (TIMESTAMP DEFAULT NOW())
* `actif` (BOOLEAN DEFAULT true)

**Filtres catalogue (relation Nâ€“N via tables ci-dessous) :** familles olfactives, occasions, univers Ã©motionnels.

---

### 4ï¸âƒ£ Table `product_images` (galerie par produit)

Plusieurs visuels par parfum (packaging, mise en situation).

**Champs :**

* `image_id` (PK, SERIAL)
* `product_id` (FK â†’ products)
* `url` (VARCHAR NOT NULL)
* `ordre` (INTEGER DEFAULT 0, pour lâ€™affichage)
* `legende` (VARCHAR, nullable)

---

### 5ï¸âƒ£ Table `olfactive_families`

Familles olfactives (Florale, BoisÃ©e, Orientale, FraÃ®che, Gourmande, etc.).

**Champs :**

* `family_id` (PK, SERIAL)
* `nom_famille` (VARCHAR UNIQUE NOT NULL)

---

### 6ï¸âƒ£ Table `product_families` (relation Nâ€“N)

Un parfum peut appartenir Ã  plusieurs familles olfactives.

**Champs :**

* `product_id` (FK â†’ products)
* `family_id` (FK â†’ olfactive_families)
* PK composite : (`product_id`, `family_id`)

---

### 7ï¸âƒ£ Table `occasions`

Occasions dâ€™utilisation (Quotidien, SoirÃ©e, Ã‰vÃ©nement, Cadeau, etc.).

**Champs :**

* `occasion_id` (PK, SERIAL)
* `libelle` (VARCHAR UNIQUE NOT NULL)

---

### 8ï¸âƒ£ Table `product_occasions` (relation Nâ€“N)

**Champs :**

* `product_id` (FK â†’ products)
* `occasion_id` (FK â†’ occasions)
* PK composite : (`product_id`, `occasion_id`)

---

### 9ï¸âƒ£ Table `emotional_universes`

Univers Ã©motionnels (Ã‰lÃ©gant, Audacieux, Sensuel, Frais, Intemporel, etc.).

**Champs :**

* `universe_id` (PK, SERIAL)
* `libelle` (VARCHAR UNIQUE NOT NULL)

---

### ðŸ”Ÿ Table `product_emotional_universes` (relation Nâ€“N)

**Champs :**

* `product_id` (FK â†’ products)
* `universe_id` (FK â†’ emotional_universes)
* PK composite : (`product_id`, `universe_id`)

---

### 1ï¸âƒ£1ï¸âƒ£ Table `olfactive_notes`

Notes olfactives (tÃªte, cÅ“ur, fond).

**Champs :**

* `note_id` (PK, SERIAL)
* `nom_note` (VARCHAR NOT NULL)
* `type_note` (VARCHAR : 'tÃªte' | 'cÅ“ur' | 'fond')

---

### 1ï¸âƒ£2ï¸âƒ£ Table `product_notes` (relation Nâ€“N)

**Champs :**

* `product_id` (FK â†’ products)
* `note_id` (FK â†’ olfactive_notes)
* PK composite : (`product_id`, `note_id`)

---

### 1ï¸âƒ£3ï¸âƒ£ Table `orders` (commandes)

Fonctionne pour **clients avec ou sans compte**. Adresse de livraison structurÃ©e.

**Champs :**

* `order_id` (PK, SERIAL)
* `user_id` (FK â†’ users, nullable)
* `guest_id` (FK â†’ guests, nullable)
* `date_commande` (TIMESTAMP DEFAULT NOW())
* `statut` (VARCHAR : en_cours | payee | expediee | livree | annulee)
* `total` (DECIMAL(10,2) NOT NULL)
* **Adresse structurÃ©e :**
  * `adresse_ligne1` (VARCHAR NOT NULL)
  * `adresse_ligne2` (VARCHAR, nullable)
  * `code_postal` (VARCHAR NOT NULL)
  * `ville` (VARCHAR NOT NULL)
  * `pays` (VARCHAR NOT NULL)
* `mode_paiement` (VARCHAR : carte | mobile | etc.)
* Contrainte : **exactement un** de `user_id` ou `guest_id` rempli (CHECK ou contrainte applicative)

---

### 1ï¸âƒ£4ï¸âƒ£ Table `order_items` (dÃ©tails de commande)

**Champs :**

* `order_item_id` (PK, SERIAL)
* `order_id` (FK â†’ orders)
* `product_id` (FK â†’ products)
* `quantite` (INTEGER NOT NULL)
* `prix_unitaire` (DECIMAL(10,2) NOT NULL)

---

### 1ï¸âƒ£5ï¸âƒ£ Table `payments`

**Champs :**

* `payment_id` (PK, SERIAL)
* `order_id` (FK â†’ orders UNIQUE)
* `montant` (DECIMAL(10,2) NOT NULL)
* `moyen_paiement` (VARCHAR)
* `statut_paiement` (VARCHAR : en_attente | accepte | refuse | rembourse)
* `date_paiement` (TIMESTAMP, nullable)
* `reference_externe` (VARCHAR, nullable, ex. id Stripe)

---

### 1ï¸âƒ£6ï¸âƒ£ Table `reviews` (avis clients)

Avis laissÃ©s par des **comptes clients** ou par des **invitÃ©s** (aprÃ¨s achat).

**Champs :**

* `review_id` (PK, SERIAL)
* `product_id` (FK â†’ products)
* `user_id` (FK â†’ users, nullable)
* `guest_id` (FK â†’ guests, nullable)
* `note` (INTEGER CHECK (note >= 1 AND note <= 5))
* `commentaire` (TEXT, nullable)
* `date_avis` (TIMESTAMP DEFAULT NOW())
* `modere` (BOOLEAN DEFAULT false, optionnel)
* Contrainte : **exactement un** de `user_id` ou `guest_id` rempli

---

### 1ï¸âƒ£7ï¸âƒ£ Table `deliveries`

**Champs :**

* `delivery_id` (PK, SERIAL)
* `order_id` (FK â†’ orders UNIQUE)
* `transporteur` (VARCHAR)
* `numero_suivi` (VARCHAR, nullable)
* `statut_livraison` (VARCHAR : en_preparation | expedie | en_transit | livree)
* `date_expedition` (TIMESTAMP, nullable)
* `date_livraison_estimee` (DATE, nullable)

---

## ðŸ“¦ Tables fidÃ©lisation & marketing (intÃ©grÃ©es au schÃ©ma)

### 1ï¸âƒ£8ï¸âƒ£ Table `loyalty_points` (fidÃ©lisation)

**Champs :**

* `loyalty_id` (PK, SERIAL)
* `user_id` (FK â†’ users UNIQUE)
* `points` (INTEGER DEFAULT 0)
* `date_mise_a_jour` (TIMESTAMP DEFAULT NOW())
* Optionnel : table `loyalty_history` (user_id, points_ajoutes, points_utilises, motif, date) pour lâ€™historique

---

### 1ï¸âƒ£9ï¸âƒ£ Table `newsletter`

Inscriptions Ã  la newsletter (avec consentement RGPD).

**Champs :**

* `newsletter_id` (PK, SERIAL)
* `email` (VARCHAR UNIQUE NOT NULL)
* `date_inscription` (TIMESTAMP DEFAULT NOW())
* `actif` (BOOLEAN DEFAULT true)
* `source` (VARCHAR, nullable : 'site' | 'commande' | etc.)
* `user_id` (FK â†’ users, nullable, si liÃ© Ã  un compte)

---

### 2ï¸âƒ£0ï¸âƒ£ Table `promotions`

**Champs :**

* `promotion_id` (PK, SERIAL)
* `code` (VARCHAR UNIQUE, ex. PROMO20)
* `description` (TEXT, nullable)
* `type` (VARCHAR : pourcentage | montant_fixe)
* `valeur` (DECIMAL(10,2), ex. 20 pour 20 % ou 10 pour 10 â‚¬)
* `date_debut` (TIMESTAMP NOT NULL)
* `date_fin` (TIMESTAMP NOT NULL)
* `usage_max` (INTEGER, nullable, nombre dâ€™utilisations totales)
* `actif` (BOOLEAN DEFAULT true)

---

### 2ï¸âƒ£1ï¸âƒ£ Table `gift_boxes` (coffrets cadeaux)

**Champs :**

* `gift_box_id` (PK, SERIAL)
* `nom` (VARCHAR NOT NULL)
* `description` (TEXT)
* `prix` (DECIMAL(10,2) NOT NULL)
* `image_principale` (VARCHAR)
* `actif` (BOOLEAN DEFAULT true)
* `date_ajout` (TIMESTAMP DEFAULT NOW())

Table de liaison **`gift_box_products`** (coffret â†” parfums) :

* `gift_box_id` (FK â†’ gift_boxes)
* `product_id` (FK â†’ products)
* `quantite` (INTEGER DEFAULT 1)
* PK composite : (`gift_box_id`, `product_id`)

---

## ðŸ” SÃ©curitÃ© & conformitÃ©

* Mots de passe **toujours hashÃ©s** (bcrypt ou Ã©quivalent), jamais en clair
* DonnÃ©es personnelles **minimisÃ©es** ; champs RGPD explicites (`consentement_newsletter`, `consentement_cookies`, `date_consentement`)
* **Suppression / anonymisation** des donnÃ©es sur demande (droit Ã  lâ€™oubli)
* AccÃ¨s **administrateur** sÃ©parÃ© (rÃ´le `admin` dans `users`)
* **Sauvegardes rÃ©guliÃ¨res** de la base UrbanS
* RequÃªtes **paramÃ©trÃ©es** pour Ã©viter les injections SQL
* Connexion Ã  la base en **SSL** en production

---

## ðŸ§  SchÃ©ma relationnel simplifiÃ© (aprÃ¨s amÃ©liorations)

```
Users â”€â”€â”¬â”€â”€ Orders â”€â”€ Order_items â”€â”€ Products â”€â”€ Product_images
        â”‚       â”‚            â”‚            â”œâ”€â”€ Product_families â”€â”€ Olfactive_families
        â”‚       â”‚            â”‚            â”œâ”€â”€ Product_occasions â”€â”€ Occasions
        â”‚       â”‚            â”‚            â”œâ”€â”€ Product_emotional_universes â”€â”€ Emotional_universes
        â”‚       â”‚            â”‚            â”œâ”€â”€ Product_notes â”€â”€ Olfactive_notes
        â”‚       â”‚            â”‚            â””â”€â”€ Reviews
        â”‚       â”œâ”€â”€ Payments
        â”‚       â””â”€â”€ Deliveries
        â”œâ”€â”€ Loyalty_points
        â””â”€â”€ Newsletter (optionnel)

Guests â”€â”€â”¬â”€â”€ Orders (mÃªme schÃ©ma quâ€™au-dessus)
         â””â”€â”€ Reviews (guest_id)

Promotions (utilisÃ©e au moment de la commande)
Gift_boxes â”€â”€ Gift_box_products â”€â”€ Products
```

---

## âœ… RÃ©sumÃ©

La base **UrbanS** (PostgreSQL) est dÃ©crite pour Ãªtre :

* **Conforme au projet** : catalogue, filtres, commande avec/sans compte, avis, paiement, livraison
* **AlignÃ©e avec la doc fonctionnelle** : occasions, univers Ã©motionnels, images, adresses structurÃ©es, RGPD
* **Ã‰volutive** : fidÃ©lisation, newsletter, promotions, coffrets cadeaux
* **SÃ©curisÃ©e et maintenable** : contraintes, rÃ´les, bonnes pratiques

Pour crÃ©er les tables dans **UrbanS**, tu peux tâ€™appuyer sur un fichier de **migrations SQL** (Ã  gÃ©nÃ©rer Ã  partir de cette structure) ou un outil type Prisma / Drizzle en prÃ©cisant la base `UrbanS`.
